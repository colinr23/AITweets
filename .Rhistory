setwd("E:/wlu/research/salmonella/outbreakAlgo")
getwd()
x <- read.csv("../Donkeys2.csv")
names(x)
library(surveillance)
out.f <- list()
#GLOBAL PARAMS
T <- 52   #weeks with results - 2010 only
startWeek <- 108
for(i in 4:226) {
Hall <- cbind(wk=1:length(x[54:212,1]), cnt=x[54:212,i]) #matrix   EDITED TO TAKE ONLY 2008 ONWARDS FOR COMPARABILITY TO ANIMAL AND FOOD
hall_dpg <- create.disProg(week=Hall[,1], observed=Hall[,2], state=rep(0, length(Hall[,1])))
hall_farr <- algo.farrington(hall_dpg, control=list(range=startWeek:length(Hall[,1]), b=2, w=3, reweight=TRUE, trend=FALSE, alpha=0.01, powertrans="1/2", limit54=c(1,1)))
#hall_rki <- algo.rki(hall_dpg, control = list(range = startWeek:length(Hall[,1]), b = 2,w = 3, actY = TRUE))
#hall_bayes <- algo.bayes(hall_dpg, control = list(range = startWeek:length(Hall[,1]), b = 2,w = 3, actY = TRUE,alpha=0.01))
out.f[i-3] <- list(hall_farr)
}
numTypes <- 103    #number of subtypes for Hall
xx <- x[startWeek:length(Hall[,1]),1:106]
outmat <- matrix(nrow=T, ncol=numTypes)
ii <- 1
lbs <- names(x)[4:106]
lbsx <- vector(length=length(lbs))
for(i in seq(1,numTypes, 3)) {
outmat[,i] <- out.f[[ii]]$alarm
lbsx[i] <- paste(lbs[ii], "_Far", sep="")
ii <- ii + 1
}
outdf <- data.frame(outmat)
names(outdf) <- lbsx
xx <- cbind(xx, outdf)
write.csv(file="H_all.csv", xx)
numTypes <- 55    #number of subtypes for Hall    107-161
xx <- x[startWeek:length(Hall[,1]),c(1:3, 107:161)]
outmat <- matrix(nrow=T, ncol=numTypes)
ii <- 1
lbs <- names(x)[107:161]
lbsx <- vector(length=length(lbs))
for(i in seq(1,numTypes, 3)) {
outmat[,i] <- out.f[[ii]]$alarm
lbsx[i] <- paste(lbs[ii], "_Far", sep="")
ii <- ii + 1
}
outdf <- data.frame(outmat)
names(outdf) <- lbsx
xx <- cbind(xx, outdf)
write.csv(file="H_end.csv", xx)
numTypes <- 52    #number of subtypes for Hall    162-213
xx <- x[startWeek:length(Hall[,1]),c(1:3, 162:213)]
outmat <- matrix(nrow=T, ncol=numTypes)
ii <- 1
lbs <- names(x)[162:213]
lbsx <- vector(length=length(lbs))
for(i in seq(1,numTypes, 3)) {
outmat[,i] <- out.f[[ii]]$alarm
lbsx[i] <- paste(lbs[ii], "_Far", sep="")
ii <- ii + 1
}
outdf <- data.frame(outmat)
names(outdf) <- lbsx
xx <- cbind(xx, outdf)
write.csv(file="H_animal.csv", xx)
numTypes <- 13    #number of subtypes for Hall    162-213
xx <- x[startWeek:length(Hall[,1]),c(1:3, 214:226)]
outmat <- matrix(nrow=T, ncol=numTypes)
ii <- 1
lbs <- names(x)[214:226]
lbsx <- vector(length=length(lbs))
for(i in seq(1,numTypes, 3)) {
outmat[,i] <- out.f[[ii]]$alarm
lbsx[i] <- paste(lbs[ii], "_Far", sep="")
ii <- ii + 1
}
outdf <- data.frame(outmat)
names(outdf) <- lbsx
xx <- cbind(xx, outdf)
write.csv(file="H_food.csv", xx)
allLabs <- names(x)[4:226]
allLabs <- unlist(sapply(FUN=strsplit, allLabs, "_"))
allLabs <- allLabs[seq(2,length(allLabs),2)]
#x1 <- read.csv("H_all.csv")
x2 <- read.csv("H_end.csv")
x3 <- read.csv("H_animal.csv")
x4 <- read.csv("H_food.csv")
xxx2 <- x2[,which(names(x2)=="Hend_4512i_Far"):length(names(x2))]
xxx3 <- x3[,which(names(x3)=="ACt_4512i_Far"):length(names(x3))]
xxx4 <- x4[,which(names(x4)=="Fch_4512i_Far"):length(names(x4))]
xxx <- cbind(xxx2, xxx3, xxx4)  #all outbreak data
names(xxx)
numTypes <- 103    #number of subtypes for Hall
xx <- x[startWeek:length(Hall[,1]),1:106]
outmat <- matrix(nrow=T, ncol=numTypes)
ii <- 1
lbs <- names(x)[4:106]
lbsx <- vector(length=length(lbs))
for(i in seq(1,numTypes)) {
outmat[,i] <- out.f[[ii]]$alarm
lbsx[i] <- paste(lbs[ii], "_Far", sep="")
ii <- ii + 1
}
outdf <- data.frame(outmat)
names(outdf) <- lbsx
xx <- cbind(xx, outdf)
write.csv(file="H_all.csv", xx)
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#*************************************************************
#HHHHHHHHHHHEEEEEEEEEEEEEEEEEEEENNNNNNNNNNNNNNNNNNNNNNNNNNNNDDDDDDDDDDDDDDDDDDDD
numTypes <- 55    #number of subtypes for Hall    107-161
xx <- x[startWeek:length(Hall[,1]),c(1:3, 107:161)]
outmat <- matrix(nrow=T, ncol=numTypes)
ii <- 1
lbs <- names(x)[107:161]
lbsx <- vector(length=length(lbs))
for(i in seq(1,numTypes)) {
outmat[,i] <- out.f[[ii]]$alarm
lbsx[i] <- paste(lbs[ii], "_Far", sep="")
ii <- ii + 1
}
outdf <- data.frame(outmat)
names(outdf) <- lbsx
xx <- cbind(xx, outdf)
write.csv(file="H_end.csv", xx)
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#*************************************************************
#AAAAAAAAAAAAAAAAAAAAANNNNNNNNNNNNNNNNIIIIIIIIIIIIMMMMMMMMMMMMMMMMMMAAAAAAAAAALLLLLLLLLLLLLLL
numTypes <- 52    #number of subtypes for Hall    162-213
xx <- x[startWeek:length(Hall[,1]),c(1:3, 162:213)]
outmat <- matrix(nrow=T, ncol=numTypes)
ii <- 1
lbs <- names(x)[162:213]
lbsx <- vector(length=length(lbs))
for(i in seq(1,numTypes)) {
outmat[,i] <- out.f[[ii]]$alarm
lbsx[i] <- paste(lbs[ii], "_Far", sep="")
ii <- ii + 1
}
outdf <- data.frame(outmat)
names(outdf) <- lbsx
xx <- cbind(xx, outdf)
write.csv(file="H_animal.csv", xx)
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#*************************************************************
#ffffffffffffffffoooooooooooooooooooooooooooooooooooooooooooooooddddddddddddddddddddddddd
numTypes <- 13    #number of subtypes for Hall    162-213
xx <- x[startWeek:length(Hall[,1]),c(1:3, 214:226)]
outmat <- matrix(nrow=T, ncol=numTypes)
ii <- 1
lbs <- names(x)[214:226]
lbsx <- vector(length=length(lbs))
for(i in seq(1,numTypes)) {
outmat[,i] <- out.f[[ii]]$alarm
lbsx[i] <- paste(lbs[ii], "_Far", sep="")
ii <- ii + 1
}
outdf <- data.frame(outmat)
names(outdf) <- lbsx
xx <- cbind(xx, outdf)
write.csv(file="H_food.csv", xx)
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#*************************************************************
allLabs <- names(x)[4:226]
allLabs <- unlist(sapply(FUN=strsplit, allLabs, "_"))
allLabs <- allLabs[seq(2,length(allLabs),2)]
#x1 <- read.csv("H_all.csv")
x2 <- read.csv("H_end.csv")
x3 <- read.csv("H_animal.csv")
x4 <- read.csv("H_food.csv")
xxx2 <- x2[,which(names(x2)=="Hend_4512i_Far"):length(names(x2))]
xxx3 <- x3[,which(names(x3)=="ACt_4512i_Far"):length(names(x3))]
xxx4 <- x4[,which(names(x4)=="Fch_4512i_Far"):length(names(x4))]
xxx <- cbind(xxx2, xxx3, xxx4)  #all outbreak data
names(xxx)
species
allLabs[55]
x2 <- read.csv("H_end.csv")
x3 <- read.csv("H_animal.csv")
x4 <- read.csv("H_food.csv")
xxx2 <- x2[,which(names(x2)=="Hend_4512i_Far"):length(names(x2))]
xxx3 <- x3[,which(names(x3)=="ACt_4512i_Far"):length(names(x3))]
xxx4 <- x4[,which(names(x4)=="Fch_4512i_Far"):length(names(x4))]
xxx <- cbind(xxx2, xxx3, xxx4)  #all outbreak data
#for each disease
#for each time period
#if set new outbreak then findConcurrent outbreaks
allLabs <- names(xxx)
allLabs <- unlist(sapply(FUN=strsplit, allLabs, "_"))
allLabs <- allLabs[seq(2,length(allLabs),2)]
ct <- vector(length=length(xxx[,1]))
ct[] <- 0
for(i in 1:length(xxx[1,])) {      #for each disease
for(t in 1:length(xxx[,1])) {                       #for each time
if(xxx[t,i] > 0) {                                                 #outbreak
if(i < which(names(xxx)=="ACt_4512i_Far")) { species = "human" }
if(i >= which(names(xxx)=="ACt_4512i_Far") & i < which(names(xxx)=="Fch_4512i_Far")) { species = "animal" }
if(i >= which(names(xxx)=="Fch_4512i_Far")) { species = "food" }
subtype = unlist(strsplit(names(xxx)[i], "_"))[2]
ct[t] <- ct[t] + findConcurrentOutbreaks(species, subtype, t)          #are there outbreaks in this subtype in the other two????
}
}
}
t
i
species
indices <- 55 + as.numeric(which(allLabs[55:length(allLabs)] == subtype))
indices
indices <- 55 + (as.numeric(which(allLabs[55:length(allLabs)] == subtype)))
indices
as.numeric(which(allLabs[55:length(allLabs)] == subtype))
which(allLabs[55:length(allLabs)] == subtype)
head(allLabs)
allLabs <- names(xxx)
allLabs <- unlist(sapply(FUN=strsplit, allLabs, "_"))
head(allLabs)
sapply(FUN=strsplit, allLabs, "_")
allLabs <- names(xxx)
allLabs <- unlist(sapply(FUN=strsplit, allLabs, "_"))
allLabs <- allLabs[seq(2,length(allLabs),3)]
allLabs
allLabs <- c(allLabs[seq(2,length(allLabs),3)])
allLabs
allLabs <- names(xxx)
allLabs <- unlist(sapply(FUN=strsplit, allLabs, "_"))
allLabs <- c(allLabs[seq(2,length(allLabs),3)])
ct <- vector(length=length(xxx[,1]))
ct[] <- 0
for(i in 1:length(xxx[1,])) {      #for each disease
for(t in 1:length(xxx[,1])) {                       #for each time
if(xxx[t,i] > 0) {                                                 #outbreak
if(i < which(names(xxx)=="ACt_4512i_Far")) { species = "human" }
if(i >= which(names(xxx)=="ACt_4512i_Far") & i < which(names(xxx)=="Fch_4512i_Far")) { species = "animal" }
if(i >= which(names(xxx)=="Fch_4512i_Far")) { species = "food" }
subtype = unlist(strsplit(names(xxx)[i], "_"))[2]
ct[t] <- ct[t] + findConcurrentOutbreaks(species, subtype, t)          #are there outbreaks in this subtype in the other two????
}
}
}
t
i
species
subtype
xxx[t,i]
indices <- 55 + as.numeric(which(allLabs[55:length(allLabs)] == subtype))
indices
which(allLabs[55:length(allLabs)] == subtype)
allLabs[55:length(allLabs)]
head(allLabs[55:length(allLabs)])
allLabs <- names(xxx)
allLabs <- unlist(sapply(FUN=strsplit, allLabs, "_"))
allLabs <- c(allLabs[seq(2,length(allLabs),3)])
head(allLabs[55:length(allLabs)])
c?
?
]
?c
allLabs <- names(xxx)
allLabs <- unlist(sapply(FUN=strsplit, allLabs, "_"))
allLabs <- as.vector(allLabs[seq(2,length(allLabs),3)])
head(allLabs[55:length(allLabs)])
which(allLabs[55:length(allLabs)] == subtype)
allLabs[55:length(allLabs)]
subtype
which(allLabs[55:length(allLabs)] == subtype)
which(allLabs[55:length(allLabs)] == subtype) >= 0
(which(allLabs[55:length(allLabs)] == subtype) >= 0) == TRUE
library(surveillance)
date
date()
date() <= date() +45
date() <= as.Date(date()) + 45
as.Date(date()) <= as.Date(date()) + 45
getwd()
setwd("C:/Users/crobertson/Dropbox/nsercCREATE/Scraping/tweets/outputs/AITweets")
x <- read.csv("test2_clean.csv")
names(x)
x$D <- as.POSIXct(strptime(as.character(x$created_at), "%a %b %d %H:%M:%S %z %Y"))
x$day <- as.Date(x$D)
library(plyr)
library(ggplot2)
x$textC <- removeURL(x$text)
removeURL <- function(x) gsub("http[^[:space:]]*", "", x)
library(plyr)
library(ggplot2)
x$D <- as.POSIXct(strptime(as.character(x$created_at), "%a %b %d %H:%M:%S %z %Y"))
x$day <- as.Date(x$D)
x$textC <- removeURL(x$text)
x <- x[!duplicated(x$textC), ]
daily <- ddply(x, .(day), summarise, numTweets = length(day)) #summarize by mean
head(daily)
dim(daily)
which(daily$day <= date())
date()
max(daily$day)
max(daily$day)-7
max(daily$day)-28
dim(daily)
recent <- subset(daily, day >= max(daily$day)-28)
dim(recent)
recent <- subset(daily, day >= max(daily$day)-21)
dim(recent)
